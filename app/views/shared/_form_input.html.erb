<%
  # Enhanced Form Input Component with Validation
  # Provides accessible form inputs with inline validation feedback
  # Usage: <%= render 'shared/form_input', name: 'email', label: 'Email', type: 'email', required: true, error: @error %>
  
  name ||= 'input'
  label ||= 'Campo'
  type ||= 'text'
  placeholder ||= ''
  value ||= ''
  required ||= false
  disabled ||= false
  error ||= nil
  help_text ||= nil
  icon ||= nil
%>

<div class="form-group mb-4">
  <!-- Label -->
  <label for="<%= name %>" class="block text-sm font-medium text-gray-700 mb-2">
    <%= label %>
    <% if required %>
      <span class="text-red-500" aria-label="Campo requerido">*</span>
    <% end %>
  </label>

  <!-- Input Container -->
  <div class="relative">
    <!-- Icon (if provided) -->
    <% if icon %>
      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
        <i class="<%= icon %> text-gray-400" aria-hidden="true"></i>
      </div>
    <% end %>

    <!-- Input Field -->
    <input type="<%= type %>"
           id="<%= name %>"
           name="<%= name %>"
           value="<%= value %>"
           placeholder="<%= placeholder %>"
           <%= 'required' if required %>
           <%= 'disabled' if disabled %>
           class="block w-full <%= icon ? 'pl-10' : 'pl-3' %> pr-10 py-2 text-base border <%= error ? 'border-red-300 text-red-900 placeholder-red-300 focus:ring-red-500 focus:border-red-500' : 'border-gray-300 focus:ring-indigo-500 focus:border-indigo-500' %> rounded-md shadow-sm focus:outline-none focus:ring-2 <%= disabled ? 'bg-gray-100 cursor-not-allowed' : '' %> transition-colors"
           aria-invalid="<%= error ? 'true' : 'false' %>"
           <%= "aria-describedby=\"#{name}-error\"" if error %>
           <%= "aria-describedby=\"#{name}-help\"" if help_text %>
           x-data="{ touched: false }"
           @blur="touched = true"
           x-bind:class="{ 'border-green-500 focus:ring-green-500 focus:border-green-500': touched && !error && value !== '' }">

    <!-- Validation Icon -->
    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
      <% if error %>
        <svg class="h-5 w-5 text-red-500" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
        </svg>
      <% end %>
    </div>
  </div>

  <!-- Error Message -->
  <% if error %>
    <p class="mt-2 text-sm text-red-600" id="<%= name %>-error" role="alert">
      <i class="fa-solid fa-circle-exclamation mr-1" aria-hidden="true"></i>
      <%= error %>
    </p>
  <% end %>

  <!-- Help Text -->
  <% if help_text && !error %>
    <p class="mt-2 text-sm text-gray-500" id="<%= name %>-help">
      <%= help_text %>
    </p>
  <% end %>
</div>

<style>
  /* Focus ring styling for better accessibility */
  input:focus {
    outline: 2px solid transparent;
    outline-offset: 2px;
  }

  /* Success state for valid inputs */
  input.border-green-500 + div svg {
    color: rgb(34 197 94);
  }

  /* Animate validation icons */
  .form-group svg {
    transition: all 0.2s ease-in-out;
  }
</style>

