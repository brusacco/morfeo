<%
  # Contextual Help Tooltip Component
  # Provides helpful explanations for metrics and features
  # Usage: <%= render 'shared/tooltip', content: 'Explanation text', position: 'top' %>
  
  content ||= 'Información adicional'
  position ||= 'top' # top, bottom, left, right
  icon ||= 'fa-circle-info'
  size ||= 'md' # sm, md, lg
%>

<div class="tooltip-wrapper inline-flex items-center" x-data="{ show: false }">
  <button @mouseenter="show = true" 
          @mouseleave="show = false"
          @focus="show = true"
          @blur="show = false"
          type="button"
          class="tooltip-trigger text-gray-400 hover:text-indigo-600 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 rounded-full"
          aria-label="Más información">
    <i class="<%= icon %> <%= size == 'sm' ? 'text-xs' : size == 'lg' ? 'text-lg' : 'text-sm' %>"></i>
  </button>

  <!-- Tooltip Content -->
  <div x-show="show"
       x-transition:enter="transition ease-out duration-200"
       x-transition:enter-start="opacity-0 scale-95"
       x-transition:enter-end="opacity-100 scale-100"
       x-transition:leave="transition ease-in duration-150"
       x-transition:leave-start="opacity-100 scale-100"
       x-transition:leave-end="opacity-0 scale-95"
       class="tooltip-content absolute z-50 px-3 py-2 text-sm font-medium text-white bg-gray-900 rounded-lg shadow-lg max-w-xs
              <%= case position
                  when 'top' then '-top-2 left-1/2 transform -translate-x-1/2 -translate-y-full mb-2'
                  when 'bottom' then '-bottom-2 left-1/2 transform -translate-x-1/2 translate-y-full mt-2'
                  when 'left' then 'top-1/2 -left-2 transform -translate-x-full -translate-y-1/2 mr-2'
                  when 'right' then 'top-1/2 -right-2 transform translate-x-full -translate-y-1/2 ml-2'
                  end %>"
       style="display: none;"
       role="tooltip">
    <%= content %>
    
    <!-- Tooltip Arrow -->
    <div class="tooltip-arrow absolute w-2 h-2 bg-gray-900 transform rotate-45
                <%= case position
                    when 'top' then 'bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2'
                    when 'bottom' then 'top-0 left-1/2 -translate-x-1/2 -translate-y-1/2'
                    when 'left' then 'right-0 top-1/2 translate-x-1/2 -translate-y-1/2'
                    when 'right' then 'left-0 top-1/2 -translate-x-1/2 -translate-y-1/2'
                    end %>">
    </div>
  </div>
</div>

<style>
  .tooltip-wrapper {
    position: relative;
  }

  .tooltip-content {
    pointer-events: none;
    white-space: normal;
    word-wrap: break-word;
  }

  .tooltip-trigger:focus {
    outline: 2px solid rgb(99 102 241);
    outline-offset: 2px;
  }
</style>

