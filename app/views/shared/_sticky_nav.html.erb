<%
  # Enhanced Sticky Navigation Component for Dashboards
  # Provides desktop horizontal navigation and mobile hamburger dropdown
  # Usage: <%= render 'shared/sticky_nav', nav_id: 'topic-nav', nav_items: [...], back_to_top: true, color: 'indigo' %>
  
  nav_id ||= 'sticky-nav'
  nav_items ||= []
  back_to_top = true if back_to_top.nil?
  color ||= 'indigo'
%>

<nav class="border-b border-gray-200 shadow-md bg-white" id="<%= nav_id %>" role="navigation" aria-label="Navegación de secciones">
  <div class="mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-12">
      
      <!-- Desktop Navigation - Horizontal Links (hidden on mobile) -->
      <div class="hidden md:flex space-x-4 overflow-x-auto scrollbar-hide">
        <% nav_items.each do |item| %>
          <a href="<%= item[:href] %>" 
             data-turbo="false"
             class="px-3 py-2 text-sm font-medium text-gray-700 hover:text-<%= color %>-600 hover:bg-<%= color %>-50 rounded-md transition-colors whitespace-nowrap"
             aria-label="<%= item[:aria_label] %>">
            <i class="<%= item[:icon] %> mr-2" aria-hidden="true"></i>
            <%= item[:label] %>
          </a>
        <% end %>
      </div>

      <!-- Mobile Navigation - Hamburger Menu -->
      <div class="md:hidden flex-1" x-data="{ open: false }">
        <button @click="open = !open"
                class="inline-flex items-center px-3 py-2 text-sm font-medium text-gray-700 hover:text-<%= color %>-600 hover:bg-<%= color %>-50 rounded-md transition-colors"
                aria-expanded="false"
                aria-haspopup="true"
                aria-label="Menú de navegación">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
          <span>Secciones</span>
          <svg class="w-4 h-4 ml-2 transition-transform duration-200"
               :class="{ 'rotate-180': open }"
               fill="currentColor" 
               viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
          </svg>
        </button>

        <!-- Mobile Dropdown Menu -->
        <div x-show="open"
             @click.away="open = false"
             x-transition:enter="transition ease-out duration-200"
             x-transition:enter-start="opacity-0 scale-95"
             x-transition:enter-end="opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-150"
             x-transition:leave-start="opacity-100 scale-100"
             x-transition:leave-end="opacity-0 scale-95"
             class="absolute left-0 right-0 mt-2 mx-4 bg-white rounded-lg shadow-xl ring-1 ring-black ring-opacity-5 z-50"
             style="display: none;">
          <div class="py-2">
            <% nav_items.each do |item| %>
              <a href="<%= item[:href] %>" 
                 @click="open = false"
                 data-turbo="false"
                 class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-<%= color %>-50 hover:text-<%= color %>-700 transition-colors"
                 aria-label="<%= item[:aria_label] %>">
                <i class="<%= item[:icon] %> w-5 text-center mr-3" aria-hidden="true"></i>
                <span class="flex-1"><%= item[:label] %></span>
              </a>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Back to Top Button (always visible on right) -->
      <% if back_to_top %>
        <a href="#" 
           id="backToTop" 
           class="ml-4 inline-flex items-center px-3 py-2 text-sm font-medium text-<%= color %>-600 hover:text-<%= color %>-700 hover:bg-<%= color %>-50 rounded-md transition-colors cursor-pointer whitespace-nowrap"
           aria-label="Volver arriba">
          <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
            <path fill-rule="evenodd" d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z" clip-rule="evenodd" />
          </svg>
          <span class="hidden sm:inline">Arriba</span>
        </a>
      <% end %>
    </div>
  </div>
</nav>

<style>
  /* Color variations for nav items */
  .hover\:text-indigo-600:hover { color: rgb(79 70 229); }
  .hover\:bg-indigo-50:hover { background-color: rgb(238 242 255); }
  .text-indigo-600 { color: rgb(79 70 229); }
  .hover\:text-indigo-700:hover { color: rgb(67 56 202); }
  
  .hover\:text-blue-600:hover { color: rgb(37 99 235); }
  .hover\:bg-blue-50:hover { background-color: rgb(239 246 255); }
  .text-blue-600 { color: rgb(37 99 235); }
  .hover\:text-blue-700:hover { color: rgb(29 78 216); }
  
  .hover\:text-sky-600:hover { color: rgb(2 132 199); }
  .hover\:bg-sky-50:hover { background-color: rgb(240 249 255); }
  .text-sky-600 { color: rgb(2 132 199); }
  .hover\:text-sky-700:hover { color: rgb(3 105 161); }
  
  .hover\:text-purple-600:hover { color: rgb(147 51 234); }
  .hover\:bg-purple-50:hover { background-color: rgb(250 245 255); }
  .text-purple-600 { color: rgb(147 51 234); }
  .hover\:text-purple-700:hover { color: rgb(126 34 206); }
  
  .hover\:text-green-600:hover { color: rgb(22 163 74); }
  .hover\:bg-green-50:hover { background-color: rgb(240 253 244); }
  .text-green-600 { color: rgb(22 163 74); }
  .hover\:text-green-700:hover { color: rgb(21 128 61); }
</style>

<script>
  // Back to Top functionality - works with Turbo
  (function() {
    function initBackToTop() {
      const backToTopBtn = document.getElementById('backToTop');
      if (!backToTopBtn) return;
      
      // Prevent multiple initializations
      if (backToTopBtn.dataset.initialized === 'true') return;
      backToTopBtn.dataset.initialized = 'true';
      
      backToTopBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        // Scroll to top with cross-browser compatibility
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }
    
    // Initialize on DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initBackToTop);
    } else {
      initBackToTop();
    }
    
    // Re-initialize on Turbo navigation
    document.addEventListener('turbo:load', initBackToTop);
  })();
</script>

