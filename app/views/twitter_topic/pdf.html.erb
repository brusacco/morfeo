<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>Reporte Twitter: <%= @topic.name %> - Morfeo Analytics</title>
    <!-- Chartkick for Charts -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartkick@4.2.0/dist/chartkick.min.js"></script>

    <%# Auto-print on page load %>
    <script>
      window.onload = function() {
        window.print();
      };
    </script>

    <%# Include professional PDF styles %>
    <%= render 'shared/pdf_professional_styles' %>

    <style>
      /* Twitter-specific color variables */
      :root {
        --twitter-primary: #1DA1F2;
        --twitter-secondary: #0c7abf;
      }
    </style>
  </head>
  <body>
    <%# SLIDE 0: Professional Cover Page %>
    <%= render 'shared/pdf_section_wrapper', section_id: 'cover-page' do %>
      <%= render 'shared/pdf_cover_page',
            title: "Reporte Twitter",
            topic_name: @topic.name,
            period: pdf_date_range(days_range: @days_range),
            report_type: :twitter,
            subtitle: "An√°lisis de Engagement y Alcance" %>
    <% end %>

    <%# SLIDE 1: M√©tricas Principales %>
    <%= render 'shared/pdf_section_wrapper', section_id: 'section-1', force_new_page: true do %>
      <%= render 'shared/pdf_slide',
            slide_number: 1,
            title: "M√©tricas Principales",
            subtitle: "Rendimiento General del Per√≠odo",
            report_type: :twitter,
            topic_name: @topic.name do %>

        <%# KPIs en grid 2x2 para mejor visibilidad %>
        <%= render 'shared/pdf_kpi_slide',
              kpis: [
                {
                  value: pdf_format_number(@total_posts),
                  label: "Tweets",
                  icon: "üê¶",
                  sublabel: "publicaciones totales"
                },
                {
                  value: pdf_format_number(@total_interactions),
                  label: "Interacciones",
                  icon: "‚ù§Ô∏è",
                  sublabel: "likes, retweets, respuestas"
                },
                {
                  value: pdf_format_number(@total_views),
                  label: "Vistas",
                  icon: "üëÅÔ∏è",
                  sublabel: "alcance oficial Twitter API"
                },
                {
                  value: pdf_format_number(@average_interactions),
                  label: "Promedio",
                  icon: "üìà",
                  sublabel: "interacciones por tweet"
                }
              ],
              columns: 2,
              size: 'large' %>
      <% end %>
    <% end %>

    <%# SLIDE 2: Evoluci√≥n Temporal %>
    <%= render 'shared/pdf_section_wrapper', section_id: 'section-2', force_new_page: true do %>
      <%= render 'shared/pdf_slide',
            slide_number: 2,
            title: "Evoluci√≥n Temporal",
            subtitle: "Tweets e Interacciones por D√≠a",
            report_type: :twitter,
            topic_name: @topic.name do %>

        <%# Gr√°ficas apiladas verticalmente %>
        <div style="display: flex; flex-direction: column; gap: 24pt;">
          <%# Tweets por D√≠a %>
          <div>
            <h3 style="margin: 0 0 16pt 0; font-size: 14pt; font-weight: 700; color: #1f2937; padding-left: 12pt; border-left: 4pt solid #1DA1F2;">
              üìä Tweets por D√≠a
            </h3>
            <div style="background: white; border: 2pt solid #e5e7eb; border-radius: 12pt; padding: 20pt; box-shadow: 0 2pt 8pt rgba(0, 0, 0, 0.06);">
              <%= column_chart @chart_posts,
                    colors: ['#1DA1F2'],
                    height: '240px',
                    library: {
                      chart: { backgroundColor: 'transparent' },
                      xAxis: { labels: { style: { fontSize: '9pt', fontWeight: '600' } } },
                      yAxis: { labels: { style: { fontSize: '9pt', fontWeight: '600' } } }
                    } %>
            </div>
            <p style="margin: 12pt 0 0 0; padding: 12pt 16pt; background: #dbeafe; border-left: 4pt solid #3b82f6; border-radius: 6pt; font-size: 10pt; line-height: 1.6; color: #1e40af;">
              üí° Promedio de <strong><%= (@total_posts.to_f / @days_range).round(1) %></strong> tweets por d√≠a durante el per√≠odo analizado.
            </p>
          </div>

          <%# Interacciones por D√≠a %>
          <div>
            <h3 style="margin: 0 0 16pt 0; font-size: 14pt; font-weight: 700; color: #1f2937; padding-left: 12pt; border-left: 4pt solid #10b981;">
              ‚ù§Ô∏è Interacciones por D√≠a
            </h3>
            <div style="background: white; border: 2pt solid #e5e7eb; border-radius: 12pt; padding: 20pt; box-shadow: 0 2pt 8pt rgba(0, 0, 0, 0.06);">
              <%= column_chart @chart_interactions,
                    colors: ['#10b981'],
                    height: '240px',
                    library: {
                      chart: { backgroundColor: 'transparent' },
                      xAxis: { labels: { style: { fontSize: '9pt', fontWeight: '600' } } },
                      yAxis: { labels: { style: { fontSize: '9pt', fontWeight: '600' } } }
                    } %>
            </div>
            <p style="margin: 12pt 0 0 0; padding: 12pt 16pt; background: #d1fae5; border-left: 4pt solid #10b981; border-radius: 6pt; font-size: 10pt; line-height: 1.6; color: #065f46;">
              üí° <%= @chart_interactions.values.max > @chart_interactions.values.min * 2 ? 'Alta variabilidad' : 'Consistencia' %> en las interacciones a lo largo del per√≠odo.
            </p>
          </div>
        </div>
      <% end %>
    <% end %>

    <%# SLIDE 3: An√°lisis por Etiquetas %>
    <%= render 'shared/pdf_section_wrapper', section_id: 'section-3', force_new_page: true do %>
    <% if @tag_counts.present? && @tag_counts.any? %>
      <%= render 'shared/pdf_slide',
            slide_number: 3,
            title: "An√°lisis por Etiquetas",
            subtitle: "Distribuci√≥n de Contenido por Tags",
            report_type: :twitter,
            topic_name: @topic.name do %>

        <%# Lista de Etiquetas con Rankings %>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 32pt;">

          <%# Columna 1: Top Etiquetas por Tweets %>
          <div>
            <h3 style="margin: 0 0 20pt 0; font-size: 14pt; font-weight: 700; color: #1f2937; padding-left: 12pt; border-left: 4pt solid #1DA1F2;">
              üè∑Ô∏è Top Etiquetas por Tweets
            </h3>

            <div style="display: flex; flex-direction: column; gap: 12pt;">
              <% @tag_counts.take(10).each_with_index do |tag, index| %>
                <% tag_name = tag.respond_to?(:name) ? tag.name : tag.to_s %>
                <% count = tag.respond_to?(:count) ? tag.count : 0 %>
                <div class="tag-item" style="display: flex; align-items: center; gap: 12pt; padding: 12pt 16pt; background: white; border: 1.5pt solid #e5e7eb; border-radius: 10pt; box-shadow: 0 1pt 4pt rgba(0, 0, 0, 0.06);">
                  <%# Ranking Badge %>
                  <div style="flex: 0 0 auto; display: flex; align-items: center; justify-content: center; width: 28pt; height: 28pt; background: linear-gradient(135deg, #1DA1F2 0%, #0c7abf 100%); color: white; border-radius: 50%; font-size: 12pt; font-weight: 900; box-shadow: 0 2pt 4pt rgba(29, 161, 242, 0.3);">
                    <%= index + 1 %>
                  </div>

                  <%# Tag Icon %>
                  <div style="flex: 0 0 auto; width: 40pt; height: 40pt; border-radius: 50%; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); display: flex; align-items: center; justify-content: center; font-size: 18pt; border: 2pt solid #93c5fd;">
                    üè∑Ô∏è
                  </div>

                  <%# Info %>
                  <div style="flex: 1; min-width: 0;">
                    <div style="font-weight: 700; font-size: 10pt; color: #1f2937; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                      <%= tag_name %>
                    </div>
                    <div style="font-size: 8pt; color: #6b7280; margin-top: 2pt;">
                      Etiqueta de contenido
                    </div>
                  </div>

                  <%# M√©trica %>
                  <div style="flex: 0 0 auto; text-align: right; padding: 8pt 12pt; background: #dbeafe; border-radius: 6pt;">
                    <div style="font-size: 16pt; font-weight: 900; color: #1DA1F2; line-height: 1;">
                      <%= count %>
                    </div>
                    <div style="font-size: 7pt; color: #0c7abf; text-transform: uppercase; font-weight: 600; margin-top: 2pt;">
                      tweets
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>

          <%# Columna 2: Top Etiquetas por Interacciones %>
          <div>
            <h3 style="margin: 0 0 20pt 0; font-size: 14pt; font-weight: 700; color: #1f2937; padding-left: 12pt; border-left: 4pt solid #10b981;">
              üëç Top Etiquetas por Interacciones
            </h3>

            <div style="display: flex; flex-direction: column; gap: 12pt;">
              <% @tag_interactions.sort_by { |k, v| -v }.take(10).each_with_index do |(tag_name, interactions), index| %>
                <%
                  # Buscar el objeto tag para obtener el count
                  tag_obj = @tag_counts.find { |t| t.respond_to?(:name) && t.name == tag_name }
                  tweet_count = tag_obj&.respond_to?(:count) ? tag_obj.count : 0
                %>
                <div class="tag-item" style="display: flex; align-items: center; gap: 12pt; padding: 12pt 16pt; background: white; border: 1.5pt solid #e5e7eb; border-radius: 10pt; box-shadow: 0 1pt 4pt rgba(0, 0, 0, 0.06);">
                  <%# Ranking Badge %>
                  <div style="flex: 0 0 auto; display: flex; align-items: center; justify-content: center; width: 28pt; height: 28pt; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border-radius: 50%; font-size: 12pt; font-weight: 900; box-shadow: 0 2pt 4pt rgba(16, 185, 129, 0.3);">
                    <%= index + 1 %>
                  </div>

                  <%# Tag Icon %>
                  <div style="flex: 0 0 auto; width: 40pt; height: 40pt; border-radius: 50%; background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); display: flex; align-items: center; justify-content: center; font-size: 18pt; border: 2pt solid #6ee7b7;">
                    üè∑Ô∏è
                  </div>

                  <%# Info %>
                  <div style="flex: 1; min-width: 0;">
                    <div style="font-weight: 700; font-size: 10pt; color: #1f2937; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                      <%= tag_name %>
                    </div>
                    <div style="font-size: 8pt; color: #6b7280; margin-top: 2pt;">
                      <%= tweet_count %> tweets
                    </div>
                  </div>

                  <%# M√©trica %>
                  <div style="flex: 0 0 auto; text-align: right; padding: 8pt 12pt; background: #d1fae5; border-radius: 6pt;">
                    <div style="font-size: 16pt; font-weight: 900; color: #10b981; line-height: 1;">
                      <%= pdf_format_number(interactions) %>
                    </div>
                    <div style="font-size: 7pt; color: #059669; text-transform: uppercase; font-weight: 600; margin-top: 2pt;">
                      interac.
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>

        </div>
      <% end %>
    <% end %>
    <% end %>

    <%# SLIDE 4: An√°lisis por Perfiles %>
    <%= render 'shared/pdf_section_wrapper', section_id: 'section-4', force_new_page: true do %>
    <% if @profiles_count.present? && @profiles_count.any? %>
      <%= render 'shared/pdf_slide',
            slide_number: 4,
            title: "An√°lisis por Perfiles",
            subtitle: "Distribuci√≥n de Tweets e Interacciones",
            report_type: :twitter,
            topic_name: @topic.name do %>

        <%# Lista de Perfiles con Rankings %>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 32pt;">

          <%# Columna 1: Top Perfiles por Tweets %>
          <div>
            <h3 style="margin: 0 0 20pt 0; font-size: 14pt; font-weight: 700; color: #1f2937; padding-left: 12pt; border-left: 4pt solid #1DA1F2;">
              üê¶ Top Perfiles por Tweets
            </h3>

            <div style="display: flex; flex-direction: column; gap: 12pt;">
              <% @profiles_count.sort_by { |k, v| -v }.take(10).each_with_index do |(profile_name, count), index| %>
                <%
                  # Buscar el perfil para obtener el avatar
                  profile = TwitterProfile.find_by(name: profile_name)
                %>
                <div class="fanpage-item" style="display: flex; align-items: center; gap: 12pt; padding: 12pt 16pt; background: white; border: 1.5pt solid #e5e7eb; border-radius: 10pt; box-shadow: 0 1pt 4pt rgba(0, 0, 0, 0.06);">
                  <%# Ranking Badge %>
                  <div style="flex: 0 0 auto; display: flex; align-items: center; justify-content: center; width: 28pt; height: 28pt; background: linear-gradient(135deg, #1DA1F2 0%, #0c7abf 100%); color: white; border-radius: 50%; font-size: 12pt; font-weight: 900; box-shadow: 0 2pt 4pt rgba(29, 161, 242, 0.3);">
                    <%= index + 1 %>
                  </div>

                  <%# Avatar %>
                  <% if profile&.picture.present? %>
                    <img src="<%= profile.picture %>"
                         style="flex: 0 0 auto; width: 40pt; height: 40pt; border-radius: 50%; object-fit: cover; border: 2pt solid #e5e7eb;"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div style="display: none; flex: 0 0 auto; width: 40pt; height: 40pt; border-radius: 50%; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); align-items: center; justify-content: center; font-size: 18pt; border: 2pt solid #93c5fd;">
                      üê¶
                    </div>
                  <% else %>
                    <div style="flex: 0 0 auto; width: 40pt; height: 40pt; border-radius: 50%; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); display: flex; align-items: center; justify-content: center; font-size: 18pt; border: 2pt solid #93c5fd;">
                      üê¶
                    </div>
                  <% end %>

                  <%# Info %>
                  <div style="flex: 1; min-width: 0;">
                    <div style="font-weight: 700; font-size: 10pt; color: #1f2937; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                      <%= profile_name %>
                    </div>
                    <div style="font-size: 8pt; color: #6b7280; margin-top: 2pt;">
                      <% if profile&.username.present? %>
                        @<%= profile.username %>
                      <% else %>
                        Perfil de Twitter
                      <% end %>
                    </div>
                  </div>

                  <%# M√©trica %>
                  <div style="flex: 0 0 auto; text-align: right; padding: 8pt 12pt; background: #dbeafe; border-radius: 6pt;">
                    <div style="font-size: 16pt; font-weight: 900; color: #1DA1F2; line-height: 1;">
                      <%= pdf_format_number(count) %>
                    </div>
                    <div style="font-size: 7pt; color: #0c7abf; text-transform: uppercase; font-weight: 600; margin-top: 2pt;">
                      tweets
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>

          <%# Columna 2: Top Perfiles por Interacciones %>
          <div>
            <h3 style="margin: 0 0 20pt 0; font-size: 14pt; font-weight: 700; color: #1f2937; padding-left: 12pt; border-left: 4pt solid #10b981;">
              üëç Top Perfiles por Interacciones
            </h3>

            <div style="display: flex; flex-direction: column; gap: 12pt;">
              <% @profiles_interactions.sort_by { |k, v| -v }.take(10).each_with_index do |(profile_name, interactions), index| %>
                <%
                  # Buscar el perfil para obtener el avatar
                  profile = TwitterProfile.find_by(name: profile_name)
                %>
                <div class="fanpage-item" style="display: flex; align-items: center; gap: 12pt; padding: 12pt 16pt; background: white; border: 1.5pt solid #e5e7eb; border-radius: 10pt; box-shadow: 0 1pt 4pt rgba(0, 0, 0, 0.06);">
                  <%# Ranking Badge %>
                  <div style="flex: 0 0 auto; display: flex; align-items: center; justify-content: center; width: 28pt; height: 28pt; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border-radius: 50%; font-size: 12pt; font-weight: 900; box-shadow: 0 2pt 4pt rgba(16, 185, 129, 0.3);">
                    <%= index + 1 %>
                  </div>

                  <%# Avatar %>
                  <% if profile&.picture.present? %>
                    <img src="<%= profile.picture %>"
                         style="flex: 0 0 auto; width: 40pt; height: 40pt; border-radius: 50%; object-fit: cover; border: 2pt solid #e5e7eb;"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div style="display: none; flex: 0 0 auto; width: 40pt; height: 40pt; border-radius: 50%; background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); align-items: center; justify-content: center; font-size: 18pt; border: 2pt solid #6ee7b7;">
                      üê¶
                    </div>
                  <% else %>
                    <div style="flex: 0 0 auto; width: 40pt; height: 40pt; border-radius: 50%; background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); display: flex; align-items: center; justify-content: center; font-size: 18pt; border: 2pt solid #6ee7b7;">
                      üê¶
                    </div>
                  <% end %>

                  <%# Info %>
                  <div style="flex: 1; min-width: 0;">
                    <div style="font-weight: 700; font-size: 10pt; color: #1f2937; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                      <%= profile_name %>
                    </div>
                    <div style="font-size: 8pt; color: #6b7280; margin-top: 2pt;">
                      <%= @profiles_count[profile_name] || 0 %> tweets
                    </div>
                  </div>

                  <%# M√©trica %>
                  <div style="flex: 0 0 auto; text-align: right; padding: 8pt 12pt; background: #d1fae5; border-radius: 6pt;">
                    <div style="font-size: 16pt; font-weight: 900; color: #10b981; line-height: 1;">
                      <%= pdf_format_number(interactions) %>
                    </div>
                    <div style="font-size: 7pt; color: #059669; text-transform: uppercase; font-weight: 600; margin-top: 2pt;">
                      interac.
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>

        </div>
      <% end %>
    <% end %>
    <% end %>

    <%# SLIDE 5: An√°lisis de Palabras %>
    <%= render 'shared/pdf_section_wrapper', section_id: 'section-5' do %>
    <% if @word_occurrences.present? && @word_occurrences.any? %>
      <%= render 'shared/pdf_slide',
            slide_number: 5,
            title: "An√°lisis de Palabras",
            subtitle: "T√©rminos M√°s Frecuentes en Tweets",
            report_type: :twitter,
            topic_name: @topic.name do %>

        <%# Lista de Palabras con Rankings %>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 32pt;">

          <%# Columna 1: Top 10 Palabras Individuales %>
          <div>
            <h3 style="margin: 0 0 20pt 0; font-size: 14pt; font-weight: 700; color: #1f2937; padding-left: 12pt; border-left: 4pt solid #1DA1F2;">
              üí¨ Top 10 Palabras
            </h3>

            <div style="display: flex; flex-direction: column; gap: 12pt;">
              <% @word_occurrences.first(10).each_with_index do |word_data, index| %>
                <% word, count = word_data %>
                <div class="tag-item" style="display: flex; align-items: center; gap: 12pt; padding: 12pt 16pt; background: white; border: 1.5pt solid #e5e7eb; border-radius: 10pt; box-shadow: 0 1pt 4pt rgba(0, 0, 0, 0.06);">
                  <%# Ranking Badge %>
                  <div style="flex: 0 0 auto; display: flex; align-items: center; justify-content: center; width: 28pt; height: 28pt; background: linear-gradient(135deg, #1DA1F2 0%, #0c7abf 100%); color: white; border-radius: 50%; font-size: 12pt; font-weight: 900; box-shadow: 0 2pt 4pt rgba(29, 161, 242, 0.3);">
                    <%= index + 1 %>
                  </div>

                  <%# Word Icon %>
                  <div style="flex: 0 0 auto; width: 40pt; height: 40pt; border-radius: 50%; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); display: flex; align-items: center; justify-content: center; font-size: 18pt; border: 2pt solid #93c5fd;">
                    üí¨
                  </div>

                  <%# Info %>
                  <div style="flex: 1; min-width: 0;">
                    <div style="font-weight: 700; font-size: 10pt; color: #1f2937; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                      <%= word %>
                    </div>
                    <div style="font-size: 8pt; color: #6b7280; margin-top: 2pt;">
                      Palabra clave
                    </div>
                  </div>

                  <%# M√©trica %>
                  <div style="flex: 0 0 auto; text-align: right; padding: 8pt 12pt; background: #dbeafe; border-radius: 6pt;">
                    <div style="font-size: 16pt; font-weight: 900; color: #1DA1F2; line-height: 1;">
                      <%= count %>
                    </div>
                    <div style="font-size: 7pt; color: #0c7abf; text-transform: uppercase; font-weight: 600; margin-top: 2pt;">
                      menciones
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>

          <%# Columna 2: Top 10 Bigramas (frases de 2 palabras) %>
          <div>
            <h3 style="margin: 0 0 20pt 0; font-size: 14pt; font-weight: 700; color: #1f2937; padding-left: 12pt; border-left: 4pt solid #10b981;">
              üí¨üí¨ Top 10 Frases
            </h3>

            <div style="display: flex; flex-direction: column; gap: 12pt;">
              <% @bigram_occurrences.first(10).each_with_index do |bigram_data, index| %>
                <% bigram, count = bigram_data %>
                <div class="tag-item" style="display: flex; align-items: center; gap: 12pt; padding: 12pt 16pt; background: white; border: 1.5pt solid #e5e7eb; border-radius: 10pt; box-shadow: 0 1pt 4pt rgba(0, 0, 0, 0.06);">
                  <%# Ranking Badge %>
                  <div style="flex: 0 0 auto; display: flex; align-items: center; justify-content: center; width: 28pt; height: 28pt; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border-radius: 50%; font-size: 12pt; font-weight: 900; box-shadow: 0 2pt 4pt rgba(16, 185, 129, 0.3);">
                    <%= index + 1 %>
                  </div>

                  <%# Bigram Icon %>
                  <div style="flex: 0 0 auto; width: 40pt; height: 40pt; border-radius: 50%; background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); display: flex; align-items: center; justify-content: center; font-size: 18pt; border: 2pt solid #6ee7b7;">
                    üí¨
                  </div>

                  <%# Info %>
                  <div style="flex: 1; min-width: 0;">
                    <div style="font-weight: 700; font-size: 10pt; color: #1f2937; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                      <%= bigram %>
                    </div>
                    <div style="font-size: 8pt; color: #6b7280; margin-top: 2pt;">
                      Frase com√∫n
                    </div>
                  </div>

                  <%# M√©trica %>
                  <div style="flex: 0 0 auto; text-align: right; padding: 8pt 12pt; background: #d1fae5; border-radius: 6pt;">
                    <div style="font-size: 16pt; font-weight: 900; color: #10b981; line-height: 1;">
                      <%= count %>
                    </div>
                    <div style="font-size: 7pt; color: #059669; text-transform: uppercase; font-weight: 600; margin-top: 2pt;">
                      menciones
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>

        </div>
      <% end %>
    <% end %>
    <% end %>

    <%# SLIDE 6: Top Tweets %>
    <%= render 'shared/pdf_section_wrapper', section_id: 'section-6' do %>
    <% if @top_posts.present? && @top_posts.any? %>
      <%= render 'shared/pdf_slide',
            slide_number: 6,
            title: "Tweets con M√°s Interacciones",
            subtitle: "Contenido de Mayor Impacto",
            report_type: :twitter,
            topic_name: @topic.name do %>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20pt;">
          <% @top_posts.take(8).each_with_index do |post, index| %>
            <div class="post-card" style="background: white; border: 2pt solid #e0f2fe; border-radius: 10pt; padding: 14pt 16pt; box-shadow: 0 2pt 6pt rgba(29, 161, 242, 0.06);">
              <%# Header %>
              <div style="display: flex; align-items: center; gap: 10pt; margin-bottom: 10pt;">
                <span style="display: flex; align-items: center; justify-content: center; width: 28pt; height: 28pt; background: linear-gradient(135deg, #1DA1F2 0%, #0c7abf 100%); color: white; border-radius: 50%; font-size: 12pt; font-weight: 900;">#<%= index + 1 %></span>
                <div style="flex: 1; min-width: 0;">
                  <div style="font-weight: 700; color: #1f2937; font-size: 9pt; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">@<%= post.twitter_profile&.username || 'Unknown' %></div>
                  <div style="font-size: 7pt; color: #9ca3af;"><%= post.posted_at&.strftime("%d/%m/%Y") %></div>
                </div>
              </div>

              <%# Tweet Text %>
              <% if post.text.present? %>
                <p style="margin: 0 0 10pt 0; font-size: 8pt; line-height: 1.5; color: #4b5563; height: 48pt; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical;"><%= post.text %></p>
              <% end %>

              <%# Metrics Compact %>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6pt; font-size: 8pt;">
                <div style="background: #fef3c7; padding: 6pt; border-radius: 4pt; text-align: center;">
                  <div style="color: #92400e;">‚ù§Ô∏è</div>
                  <div style="font-weight: 700; color: #1f2937;"><%= pdf_format_number(post.favorite_count || 0) %></div>
                </div>
                <div style="background: #d1fae5; padding: 6pt; border-radius: 4pt; text-align: center;">
                  <div style="color: #065f46;">üîÅ</div>
                  <div style="font-weight: 700; color: #1f2937;"><%= pdf_format_number(post.retweet_count || 0) %></div>
                </div>
                <div style="background: #dbeafe; padding: 6pt; border-radius: 4pt; text-align: center;">
                  <div style="color: #1e40af;">üí¨</div>
                  <div style="font-weight: 700; color: #1f2937;"><%= pdf_format_number(post.reply_count || 0) %></div>
                </div>
                <% if post.views_count && post.views_count > 0 %>
                  <div style="background: #f3f4f6; padding: 6pt; border-radius: 4pt; text-align: center;">
                    <div style="color: #9ca3af;">üëÅÔ∏è</div>
                    <div style="font-weight: 700; color: #1f2937;"><%= pdf_format_number(post.views_count) %></div>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    <% end %>
    <% end %>

  </body>
</html>
